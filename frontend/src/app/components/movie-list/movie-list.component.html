<section class="netflix-browse">
    <!-- Hero Banner -->
    <div class="hero-banner" *ngIf="!loading && !error && featuredMovies.length > 0">
        <div class="hero-content">
            <div class="container position-relative">
                <div class="hero-details"
                    [ngClass]="{'slide-in-left': slidingDirection === 'left' && animating, 'slide-in-right': slidingDirection === 'right' && animating}">
                    <h1 class="hero-title">{{ getCurrentFeaturedMovie().title }}</h1>
                    <div class="hero-meta">
                        <span class="hero-year" *ngIf="getCurrentFeaturedMovie().releaseYear">{{
                            getCurrentFeaturedMovie().releaseYear }}</span>
                        <span class="hero-rating">{{ getCurrentFeaturedMovie().rating }}/10</span>
                        <span class="hero-duration">{{ getCurrentFeaturedMovie().duration }} min</span>
                    </div>
                    <p class="hero-description">{{ getCurrentFeaturedMovie().description }}</p>
                    <div class="hero-genres">
                        <span *ngFor="let genre of getCurrentFeaturedMovie().genre?.slice(0, 4)"
                            class="hero-genre-badge">{{ genre }}</span>
                    </div>
                    <div class="hero-actions">
                        <a [routerLink]="['/movies', getCurrentFeaturedMovie().id, 'play']"
                            class="btn btn-netflix-play">
                            <i class="bi bi-play-fill"></i> <span>Play</span>
                        </a>
                        <a [routerLink]="['/movies', getCurrentFeaturedMovie().id]" class="btn btn-netflix-more">
                            <i class="bi bi-info-circle"></i> <span>More Info</span>
                        </a>
                    </div>
                </div>
            </div>
            <div class="hero-overlay"></div>
            <div class="hero-image"
                [ngClass]="{'slide-bg-left': slidingDirection === 'left' && animating, 'slide-bg-right': slidingDirection === 'right' && animating}"
                [style.backgroundImage]="'url(' + getCurrentFeaturedMovie().posterUrl + ')'"></div>
        </div>
    </div>

    <div class="container pb-5">
        <!-- Page Title and Add Button -->
        <div *ngIf="!loading && !error && movies.length > 0"
            class="d-flex justify-content-between align-items-center mb-4 mt-4">
            <h2 class="section-title">All Movies</h2>
            <a routerLink="/movies/new" class="btn btn-netflix-add">
                <i class="bi bi-plus-lg me-1"></i>Add New Movie
            </a>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="netflix-loader">
            <div class="spinner">
                <div class="bounce1"></div>
                <div class="bounce2"></div>
                <div class="bounce3"></div>
            </div>
            <p>Loading movies...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="error" class="alert alert-danger">
            <i class="bi bi-exclamation-triangle me-2"></i>
            Failed to load movies. Please try again later.
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && !error && movies.length === 0" class="empty-state">
            <i class="bi bi-film"></i>
            <h3>No movies available</h3>
            <p>Add your first movie to get started!</p>
            <a routerLink="/movies/new" class="btn btn-netflix-add mt-3">Add Movie</a>
        </div>

        <!-- Movies Grid -->
        <div *ngIf="!loading && !error && movies.length > 0" class="netflix-movies-grid mb-5">
            <div *ngFor="let movie of movies" class="netflix-movie-item">
                <div class="netflix-movie-card">
                    <div class="movie-poster">
                        <img [src]="movie.posterUrl" [alt]="movie.title + ' poster'" loading="lazy">
                        <div class="movie-rating-badge">{{ movie.rating }}</div>
                        <div class="movie-release-badge" *ngIf="!movie.releaseDate || movie.releaseDate === null">COMING
                            SOON</div>

                        <!-- Hover Overlay -->
                        <div class="hover-overlay">
                            <div class="movie-title-overlay text-truncate">{{ movie.title }}</div>

                            <!-- Primary Controls -->
                            <div class="controls-row">
                                <a *ngIf="movie.releaseDate !== null" [routerLink]="['/movies', movie.id, 'play']"
                                    class="btn-circle btn-play">
                                    <i class="bi bi-play-fill"></i>
                                </a>
                                <div *ngIf="!movie.releaseDate || movie.releaseDate === null"
                                    class="btn-circle btn-coming-soon" title="Coming Soon">
                                    <i class="bi bi-hourglass-split"></i>
                                </div>
                                <div [routerLink]="['/movies', movie.id]" class="btn-circle btn-info"
                                    (click)="$event.stopPropagation()">
                                    <i class="bi bi-info-circle"></i>
                                </div>
                                <div class="expand-control"
                                    (click)="toggleMovieActions(movie); $event.stopPropagation()">
                                    <i class="bi bi-chevron-down"></i>
                                </div>
                            </div>

                            <!-- Movie Metadata -->
                            <div class="movie-metadata">
                                <div class="movie-year-rating">
                                    <span class="rating-age">{{ movie.rating >= 8 ? '16+' : '13+' }}</span>
                                    <span>{{ movie.duration }} min</span>
                                    <span *ngIf="movie.releaseYear">{{ movie.releaseYear }}</span>
                                </div>

                                <!-- Genres -->
                                <div class="movie-genres-overlay">
                                    <span *ngFor="let genre of movie.genre.slice(0, 2); let i = index"
                                        class="genre-badge">
                                        {{ genre }}{{ i < 1 ? ' â€¢ ' : '' }} </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action buttons only visible when expanded -->
                    <div class="movie-actions" [class.visible]="expandedMovies.get(movie.id) === true">
                        <a *ngIf="movie.releaseDate !== null" [routerLink]="['/movies', movie.id, 'play']"
                            class="btn-action btn-play" title="Play" style="color: black;">
                            <i class="bi bi-play-fill"></i>
                        </a>
                        <div *ngIf="!movie.releaseDate || movie.releaseDate === null" class="btn-action btn-coming-soon"
                            title="Coming Soon">
                            <i class="bi bi-hourglass-split"></i>
                        </div>
                        <a [routerLink]="['/movies', movie.id]" class="btn-action btn-info" title="More Info">
                            <i class="bi bi-info-circle"></i>
                        </a>
                        <a [routerLink]="['/movies', movie.id, 'edit']" class="btn-action btn-edit" title="Edit">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <button (click)="confirmDelete(movie)" class="btn-action btn-delete" title="Delete">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="d-flex justify-content-between align-items-center mb-4"
            *ngIf="!loading && !error && totalItems > 0">
            <div class="movie-count">
                Showing {{ movies.length }} of {{ totalItems }} movie{{ totalItems !== 1 ? 's' : '' }}
            </div>

            <div class="pagination-controls">
                <button class="btn-netflix-pagination" [disabled]="!previousPage" (click)="goToPreviousPage()">
                    <i class="bi bi-chevron-left"></i> Previous
                </button>
                <span class="page-info">Page {{ currentPage }}</span>
                <button class="btn-netflix-pagination" [disabled]="!nextPage" (click)="goToNextPage()">
                    Next <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <app-confirmation-modal [showModal]="showDeleteModal" title="Delete Movie"
        message="Are you sure you want to delete this movie?" (confirm)="deleteMovie()" (cancel)="cancelDelete()">
    </app-confirmation-modal>
</section>