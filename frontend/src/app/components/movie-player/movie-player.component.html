<div class="netflix-player fade-in">
    <!-- Loading State -->
    <div *ngIf="loading" class="netflix-loader">
        <div class="spinner">
            <div class="bounce1"></div>
            <div class="bounce2"></div>
            <div class="bounce3"></div>
        </div>
        <p>Loading video player...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="alert alert-danger error-container">
        <i class="bi bi-exclamation-triangle me-2"></i>
        Failed to load the movie for playback. The movie might not exist or there was a server error.
        <div class="mt-3">
            <button (click)="goBack()" class="btn btn-outline-light">
                <i class="bi bi-arrow-left me-2"></i>Go Back
            </button>
        </div>
    </div>

    <!-- Video Player -->
    <div *ngIf="!loading && !error && movie" class="player-container">
        <div class="player-header">
            <div class="header-content">
                <button (click)="goBack()" class="back-button">
                    <i class="bi bi-arrow-left"></i>
                    <span class="back-text">Back</span>
                </button>
                <div class="movie-info-mini">
                    <h1 class="playing-title">{{ movie.title }}</h1>
                </div>
            </div>
        </div>

        <div class="video-container">
            <div class="netflix-theater-mode">
                <!-- Local Video Player -->
                <div *ngIf="isUsingLocalVideo()" class="netflix-video-player">
                    <vg-player (onPlayerReady)="onPlayerReady($event)">
                        <vg-overlay-play></vg-overlay-play>
                        <vg-buffering></vg-buffering>

                        <vg-controls>
                            <vg-play-pause></vg-play-pause>
                            <vg-playback-button [playbackValues]="[ '1.0', '1.5', '2.0', '4.0' ]"></vg-playback-button>
                            <vg-time-display vgProperty="current" vgFormat="mm:ss"></vg-time-display>

                            <vg-scrub-bar [vgSlider]="true" vgFor="singleVideo">
                                <vg-scrub-bar-current-time></vg-scrub-bar-current-time>
                                <vg-scrub-bar-buffering-time></vg-scrub-bar-buffering-time>
                            </vg-scrub-bar>

                            <vg-time-display vgProperty="left" vgFormat="mm:ss"></vg-time-display>

                            <vg-mute></vg-mute>
                            <vg-volume></vg-volume>

                            <vg-fullscreen></vg-fullscreen>
                        </vg-controls>

                        <video [vgMedia]="$any(media)" #media id="singleVideo" preload="auto"
                            [src]="getFullMediaUrl(movie.videoUploadFile_url)">
                            crossorigin>
                        </video>
                    </vg-player>
                </div>

                <!-- YouTube Player -->
                <div *ngIf="isUsingYoutubeVideo()" class="youtube-video-player">
                    <iframe width="100%" height="100%" [src]="youtubeVideoUrl" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                </div>

                <!-- No Video Source Available -->
                <div *ngIf="!isUsingLocalVideo() && !isUsingYoutubeVideo()" class="no-video-message">
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        No video source available for this movie.
                    </div>
                </div>
            </div>
        </div>

        <div class="container mt-4">
            <div class="now-playing-info">
                <div class="row">
                    <div class="col-md-4">
                        <div class="poster-thumbnail">
                            <img [src]="movie.posterUploadFile_url ? getFullMediaUrl(movie.posterUploadFile_url) : movie.posterUrl"
                                [alt]="movie.title + ' poster'" class="img-fluid rounded shadow">
                        </div>
                    </div>
                    <div class="col-md-8">
                        <h2 class="playing-title-full">
                            {{ movie.title }}
                            <span class="playing-year">({{ movie.releaseYear }})</span>
                        </h2>
                        <div class="movie-metadata">
                            <span class="release-date">{{ formatReleaseDate(movie.releaseDate) }}</span>
                            <span class="separator">•</span>
                            <span class="duration">{{ movie.duration }} min</span>
                            <span class="separator">•</span>
                            <span class="rating"><i class="bi bi-star-fill text-warning me-1"></i>{{ movie.rating
                                }}/10</span>
                        </div>
                        <div class="genres-container">
                            <span *ngFor="let genre of movie.genres" class="genre-pill">{{ genre.name }}</span>
                        </div>
                        <p class="synopsis">{{ movie.description }}</p>
                        <p class="director"><strong>Director:</strong> {{ movie.director }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>